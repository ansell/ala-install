- hosts: all
  gather_facts: False
  tasks:
    - name: install python 2
      raw: sudo bash -c "test -e /usr/bin/python || (apt -qqy update && apt install -qy python-minimal python-apt)"

- hosts: image-service
  roles:
    - java
    - common
    - { role: elasticsearch, elasticsearch_version: "7.0.1-amd64", elasticsearch_download_url: "https://artifacts.elastic.co/downloads/elasticsearch" }
    - { role: db-backup, db: postgres, db_name: "images", db_user: "{{ images_db_username }}", db_password: "{{ images_db_password }}" }
    - { role: postgresql, pg_version: "10", postgis_version: "2.4" }
    - { role: pg_instance, extensions: ["citext", "pgcrypto"], db_name: "images", db_user: "{{ images_db_username }}", db_password: "{{ images_db_password }}" }
    - webserver
    - image-service
  become: yes
  become_user: root


